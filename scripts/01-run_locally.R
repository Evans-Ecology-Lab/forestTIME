# This is a script for running all of the scripts that download + process state data
# into state-level forestTIME databases locally.
library(dplyr)

delete_files <- FALSE

# Download state level files 

source("R/download_zip_from_datamart.R")


all_states <- state.abb
csv_dir <- "data/rawdat/state/"
download_zip_from_datamart(states = all_states,
                           rawdat_dir = csv_dir,
                           extract = TRUE,
                           keep_zip = TRUE)

# Download data for each sate and create state-by-state databases and parquet files
purrr::walk(all_states, \(state) {
  withr::with_envvar(new = c("STATE" = state), source("scripts/state-parquet.R"))
}, .progress = TRUE)

# Combine state files into a single database
source(here::here("scripts", "02-create_db_from_parquet.R"))

# Upload database to Zenodo
source(here::here("scripts", "03-upload_parquet_db_zenodo.R"))

# Run checks on the database
source(here::here("scripts", "04-check_db.R"))
