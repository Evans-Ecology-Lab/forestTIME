<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Population scaling • forestTIME</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="pop_scaling_files/libs/quarto-html/popper.min.js"></script><script src="pop_scaling_files/libs/quarto-html/tippy.umd.min.js"></script><link href="pop_scaling_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="pop_scaling_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="pop_scaling_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="pop_scaling_files/libs/pagedtable-1.1/js/pagedtable.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Population scaling">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">forestTIME</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/forestTIME-builder.html">forestTIME</a></li>
    <li><a class="dropdown-item" href="../articles/pop_scaling.html">Population scaling</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Evans-Ecology-Lab/forestTIME/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Population scaling</h1>




      <small class="dont-index">Source: <a href="https://github.com/Evans-Ecology-Lab/forestTIME/blob/v2.1.0/vignettes/pop_scaling.qmd" class="external-link"><code>vignettes/pop_scaling.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Evans-Ecology-Lab/forestTIME" class="external-link">forestTIME</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ! forestTIME is an experimental package and currently a work-in-progress. It is</span></span>
<span><span class="co">#&gt;   not an official product of the US Forest Service.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/doserjef/rFIA" class="external-link">rFIA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<p>How can we use the interpolated data produced by <code>forestTIME</code> to get popluation-level (i.e. state-level) per-area estimates?</p>
<div>
<blockquote>
<p><strong>Warning</strong></p>
<p>The interpolated values produced by <code>forestTIME</code> are <em>inferences</em> and not samples, so it may not be appropriate to use (modified) design-based estimators, as we do in this vignette, which treat the data, including interpolated values, as a probablity sample.</p>
</blockquote>
</div>
<section class="level2"><h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>We’ll use RI as an example state because it is small. We’ll just use the built-in example data that comes with <code>forestTIME</code>, but if you were to download your own and you wanted to use it with <code>rFIA</code> also, make sure to set <code>extract = "rFIA"</code> to extract all the tables needed for both <code>forestTIME</code> and <code>rFIA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fia_download.html">fia_download</a></span><span class="op">(</span>states <span class="op">=</span> <span class="st">"RI"</span>, download_dir <span class="op">=</span> <span class="st">"fia"</span>, extract <span class="op">=</span> <span class="st">"rFIA"</span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Important</strong></p>
<p><code>rFIA</code> produces estimates of carbon from 33 – 40.7 tons/acre using design-based estimators. “Correct” estimates should be in this ballpark.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rfia_RI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.doserlab.com/files/rFIA/reference/readFIA.html" class="external-link">readFIA</a></span><span class="op">(</span></span>
<span>  dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"exdata"</span>, package <span class="op">=</span> <span class="st">"forestTIME"</span><span class="op">)</span>,</span>
<span>  states <span class="op">=</span> <span class="st">"RI"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">agc_rfia_annual</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://www.doserlab.com/files/rFIA/reference/biomass.html" class="external-link">biomass</a></span><span class="op">(</span></span>
<span>    <span class="va">rfia_RI</span>,</span>
<span>    totals <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"annual"</span>,</span>
<span>    treeType <span class="op">=</span> <span class="st">"live"</span>,</span>
<span>    landType <span class="op">=</span> <span class="st">'forest'</span>,</span>
<span>    component <span class="op">=</span> <span class="st">"AG"</span>,</span>
<span>    areaDomain <span class="op">=</span> <span class="va">COND_STATUS_CD</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">INTENSITY</span> <span class="op">==</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"rFIA annual"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">method</span>, <span class="va">YEAR</span>, carbon_ton_acre <span class="op">=</span> <span class="va">CARB_ACRE</span>, carbon_total <span class="op">=</span> <span class="va">CARB_TOTAL</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The `.dots` argument of `group_by()` is deprecated as of dplyr 1.0.0.</span></span>
<span><span class="co">#&gt; ℹ The deprecated feature was likely used in the dplyr package.</span></span>
<span><span class="co">#&gt;   Please report the issue at &lt;https://github.com/tidyverse/dplyr/issues&gt;.</span></span>
<span></span>
<span><span class="va">agc_rfia_ti</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://www.doserlab.com/files/rFIA/reference/biomass.html" class="external-link">biomass</a></span><span class="op">(</span></span>
<span>    <span class="va">rfia_RI</span>,</span>
<span>    totals <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"TI"</span>,</span>
<span>    treeType <span class="op">=</span> <span class="st">"live"</span>,</span>
<span>    landType <span class="op">=</span> <span class="st">'forest'</span>,</span>
<span>    component <span class="op">=</span> <span class="st">"AG"</span>,</span>
<span>    areaDomain <span class="op">=</span> <span class="va">COND_STATUS_CD</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">INTENSITY</span> <span class="op">==</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"rFIA TI"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">method</span>, <span class="va">YEAR</span>, carbon_ton_acre <span class="op">=</span> <span class="va">CARB_ACRE</span>, carbon_total <span class="op">=</span> <span class="va">CARB_TOTAL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">agc_rfia_annual</span><span class="op">$</span><span class="va">carbon_ton_acre</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 34.03135</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">agc_rfia_ti</span><span class="op">$</span><span class="va">carbon_ton_acre</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 34.01003</span></span></code></pre></div>
</div>
</blockquote>
</div>
<p>We’ll use the standard basic workflow to get estimated aboveground carbon for each tree in each year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data prep</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">fia_load</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RI"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dir =</span> <span class="fu">system.file</span>(<span class="st">"exdata"</span>, <span class="at">package =</span> <span class="st">"forestTIME"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">fia_tidy</span>(db) <span class="co">#single tibble</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Wrangling data</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ Wrangling data [178ms]</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand to include all years between surveys and interpolate/extrapolate</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust for mortality and estimate carbon.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>data_midpt <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fia_annualize</span>(<span class="at">use_mortyr =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fia_estimate</span>()</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Prepping for estimating carbon</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Adjusting for mortality</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Interpolating between surveys</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Expanding years between surveys</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ Expanding years between surveys [2.3s]</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Interpolating between surveys</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>✔ Interpolating between surveys [<span class="fl">12.9</span>s]</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Adjusting for mortality</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>✔ Adjusting <span class="cf">for</span> mortality [<span class="fl">19.1</span>s]</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ Prepping for estimating carbon</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>✔ Prepping <span class="cf">for</span> estimating carbon [<span class="fl">19.2</span>s]</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ⠙ Estimating carbon: prepping data</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ⠹ Estimating carbon: finding merchantable height</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ⠸ Estimating carbon: predicting merchantable stem wood volume</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ⠼ Estimating carbon: predicting stump wood and bark volume</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ⠴ Estimating carbon: predicting sawlog stem wood volume</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ⠦ Estimating carbon: predicting sawlog stem wood and bark volume</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ Estimating carbon: harmonizing components [15.8s]</span></span></code></pre></div>
</div>
<p>I’ll add domain indicator columns as is done in the <code>rFIA</code> demystified vignette so we calculate carbon in live trees per area of forested land using base intensity plots only. Reason:</p>
<blockquote>
<p>We build separate domain indicators for estimating tree totals and area totals, because we can specify different domains of interest for both. For example, if we used our tree domain (live trees on forest land) to estimate area, then we would not actually be estimating the full forested area in RI. Instead we would estimate the forested area ONLY where live trees are currently present.</p>
</blockquote>
<p>So we can’t just <code>filter(STATUSCD == 1 &amp; COND_STATUSCD == 1)</code> to estimate carbon tons/acre.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_midpt</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">data_midpt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    aDI <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">COND_STATUS_CD</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">INTENSITY</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, <span class="co">#forested land</span></span>
<span>    tDI <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">STATUSCD</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="va">aDI</span> <span class="co">#live trees on forested land</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="expansion-factors">Expansion factors<a class="anchor" aria-label="anchor" href="#expansion-factors"></a>
</h2>
<p>The FIA data provides users with expansion factors, <code>EXPNS</code>, to aid in scaling estimates up to state levels. There are two issues in using these provided <code>EXPNS</code> with our annualized data: 1) it is not straightforward to join the tables in to get the <code>EXPNS</code> column, and 2) there are now many more plots in each year, so the <code>EXPNS</code> column is no longer accurate (it is the acres of the entire state represented by each plot). Therefore, <code><a href="../reference/fia_annualize.html">fia_annualize()</a></code> re-calculates the <code>EXPNS</code> column as the total land area of the state divided by the number of plots in the interpolated data for that state in each year.<br>
We think these <code>EXPNS</code> values can be used much in the same way as the ones in the “raw” FIA database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_midpt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">YEAR</span>, <span class="va">EXPNS</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">YEAR</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>EXPNS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">EXPNS</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">YEAR</span>, y <span class="op">=</span> <span class="va">EXPNS</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="pop_scaling_files/figure-html/expns-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You’ll notice that the calculated <code>EXPNS</code> follow a “U” shape rather than being constant. That is because in our interpolated data, there are fewer plots in the beginning and end of the timeseries because we do not extrapolate beyond a panel’s first and last inventory.</p>
<p>Using these expansion factors, we can follow the methods in the <a href="https://doserlab.com/files/rfia/articles/fiademystified#without-sampling-errors" class="external-link">FIA demystified vignette</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_totals</span> <span class="op">&lt;-</span> <span class="va">data_midpt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">plot_ID</span>, <span class="va">YEAR</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    <span class="co"># purposefully omits ajustment factor `aAdj` because it is assumed to be 1</span></span>
<span>    carbPlot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">CARBON_AG</span> <span class="op">*</span> <span class="va">TPA_UNADJ</span> <span class="op">*</span> <span class="va">EXPNS</span> <span class="op">*</span> <span class="va">tDI</span> <span class="op">/</span> <span class="fl">2000</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co">#tons/plot</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'plot_ID'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">area_totals</span> <span class="op">&lt;-</span> <span class="va">data_midpt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">plot_ID</span>, <span class="va">YEAR</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Keep only one row for each condition in each plot and year</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">CONDID</span>, <span class="va">COND_STATUS_CD</span>, <span class="va">CONDPROP_UNADJ</span>, <span class="va">EXPNS</span>, <span class="va">aDI</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    <span class="co"># purposefully omits ajustment factor `aAdj` because it is assumed to be 1</span></span>
<span>    forArea <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">CONDPROP_UNADJ</span> <span class="op">*</span> <span class="va">EXPNS</span> <span class="op">*</span> <span class="va">aDI</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#acres/plot</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'plot_ID'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">agc_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">tree_totals</span>, <span class="va">area_totals</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">YEAR</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    CARB_AG_TOTAL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">carbPlot</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># tons/plot</span></span>
<span>    AREA_TOTAL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">forArea</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># acres/plot</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># the units work out to still be tons(live carbon)/acre(forested land) even if the variable names are misleading</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"forestTIME"</span>, carbon_ton_acre <span class="op">=</span> <span class="va">CARB_AG_TOTAL</span> <span class="op">/</span> <span class="va">AREA_TOTAL</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">method</span>,</span>
<span>    <span class="va">YEAR</span>,</span>
<span>    <span class="va">carbon_ton_acre</span>,</span>
<span>    carbon_total <span class="op">=</span> <span class="va">CARB_AG_TOTAL</span>,</span>
<span>    <span class="va">AREA_TOTAL</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(plot_ID, YEAR)`</span></span>
<span><span class="va">agc_pop</span></span></code></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["method"],"name":[1],"type":["chr"],"align":["left"]},{"label":["YEAR"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["carbon_ton_acre"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["carbon_total"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["AREA_TOTAL"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"forestTIME","2":"2003","3":"34.53734","4":"11199621","5":"324275.7"},{"1":"forestTIME","2":"2004","3":"34.23811","4":"11803279","5":"344741.0"},{"1":"forestTIME","2":"2005","3":"33.00830","4":"10610049","5":"321435.8"},{"1":"forestTIME","2":"2006","3":"31.02213","4":"9146663","5":"294843.1"},{"1":"forestTIME","2":"2007","3":"30.91286","4":"8738245","5":"282673.5"},{"1":"forestTIME","2":"2008","3":"31.29413","4":"8901915","5":"284459.5"},{"1":"forestTIME","2":"2009","3":"32.45930","4":"8888673","5":"273840.6"},{"1":"forestTIME","2":"2010","3":"32.75127","4":"9454296","5":"288669.6"},{"1":"forestTIME","2":"2011","3":"33.15911","4":"9767506","5":"294564.8"},{"1":"forestTIME","2":"2012","3":"34.39447","4":"9876249","5":"287146.4"},{"1":"forestTIME","2":"2013","3":"34.75746","4":"9743841","5":"280338.1"},{"1":"forestTIME","2":"2014","3":"34.96977","4":"9771070","5":"279414.7"},{"1":"forestTIME","2":"2015","3":"34.92346","4":"9815142","5":"281047.2"},{"1":"forestTIME","2":"2016","3":"35.08612","4":"10056769","5":"286631.0"},{"1":"forestTIME","2":"2017","3":"33.65840","4":"9503182","5":"282342.1"},{"1":"forestTIME","2":"2018","3":"33.54516","4":"8826509","5":"263123.2"},{"1":"forestTIME","2":"2019","3":"34.72410","4":"9415181","5":"271142.6"},{"1":"forestTIME","2":"2020","3":"34.86392","4":"9415315","5":"270059.0"},{"1":"forestTIME","2":"2021","3":"33.61993","4":"9156489","5":"272353.0"},{"1":"forestTIME","2":"2022","3":"36.83680","4":"12550729","5":"340711.7"},{"1":"forestTIME","2":"2023","3":"38.07459","4":"14124953","5":"370981.1"},{"1":"forestTIME","2":"2024","3":"42.04380","4":"15890294","5":"377946.2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">agc_rfia_annual</span>, <span class="va">agc_rfia_ti</span>, <span class="va">agc_pop</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">all</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">YEAR</span>, y <span class="op">=</span> <span class="va">carbon_total</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Total Carbon (tons)"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="pop_scaling_files/figure-html/plot-results-1.png" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">all</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">YEAR</span>, y <span class="op">=</span> <span class="va">carbon_ton_acre</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Mean Carbon/Acre (tons/acre)"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="pop_scaling_files/figure-html/plot-results-2.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We have some ballbark similar estimates to the ones <code>rFIA</code> produces.</p>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric R. Scott, Renata Diaz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
